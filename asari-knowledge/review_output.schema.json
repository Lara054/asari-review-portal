{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://asari.review/specs/review_output.schema.v2.json",
  "title": "Asari Review Output v2 (Category-first)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "REVIEW_SUMMARY",
    "REVIEW_ISSUES",
    "REVIEW_SUGGESTED_RULES"
  ],
  "properties": {
    "REVIEW_SUMMARY": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "reviewedAt",
        "summary",
        "scores"
      ],
      "properties": {
        "reviewedAt": {
          "type": "string",
          "minLength": 10
        },
        "summary": {
          "type": "string",
          "minLength": 1
        },
        "scores": {
          "type": "object",
          "description": "カテゴリ別スコア（0〜10）。カテゴリを増やす場合は必ずここへ追加。",
          "additionalProperties": false,
          "properties": {
            "structure": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "wording": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "risk": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "delivery": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "logic": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "audience_fit": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "engagement": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "overall": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "全カテゴリから算出される総合（0〜10）"
            }
          },
          "required": [
            "overall"
          ]
        }
      }
    },
    "REVIEW_ISSUES": {
      "type": "array",
      "description": "検出された指摘一覧",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "category",
          "severity",
          "rule_id",
          "rule_title",
          "line",
          "snippet",
          "problem",
          "suggestion"
        ],
        "properties": {
          "category": {
            "type": "string",
            "enum": [
              "structure",
              "wording",
              "risk",
              "delivery",
              "logic",
              "audience_fit",
              "engagement"
            ],
            "description": "カテゴリ追加時は enum を更新"
          },
          "severity": {
            "type": "string",
            "enum": [
              "high",
              "medium",
              "low",
              "info"
            ]
          },
          "rule_id": {
            "type": "string",
            "minLength": 1
          },
          "rule_title": {
            "type": "string",
            "minLength": 1
          },
          "line": {
            "type": "integer",
            "minimum": 1
          },
          "snippet": {
            "type": "string",
            "minLength": 1
          },
          "problem": {
            "type": "string",
            "minLength": 1
          },
          "suggestion": {
            "type": "string",
            "minLength": 1
          }
        },
        "ruleset_id": {
        "type": "string",
        "minLength": 1,
        "description": "この指摘が属するルールセットID（例: base / risk / asari_persona）"
        },
        "ruleset_name": {
          "type": "string",
          "minLength": 1,
          "description": "ルールセットの表示名（例: Base Rules）"
        }
      }
    },
    "REVIEW_SUGGESTED_RULES": {
      "type": "object",
      "description": "AIが提案する新規ルールセット（base.json / persona.json と同じ構造）",
      "additionalProperties": false,
      "required": [
        "ruleset_id",
        "display_name",
        "rules"
      ],
      "properties": {
        "ruleset_id": {
          "type": "string",
          "minLength": 1,
          "description": "extension(固定値)"
        },
        "display_name": {
          "type": "string",
          "minLength": 1,
          "description": "Suggested Rules(固定値)"
        },
        "rules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "id",
              "category",
              "title",
              "description",
              "severity",
              "problem_template",
              "suggestion_template",
              "enabled"
            ],
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1
              },
              "category": {
                "type": "string",
                "enum": [
                  "structure",
                  "wording",
                  "risk",
                  "delivery",
                  "logic",
                  "audience_fit",
                  "engagement"
                ],
                "description": "5-1 の category と同じ"
              },
              "title": {
                "type": "string",
                "minLength": 1
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "severity": {
                "type": "string",
                "enum": [
                  "high",
                  "medium",
                  "low",
                  "info"
                ]
              },
              "checklist": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "このルールを適用する際に確認すべき観点の箇条書き（5-1 と同じ意味・任意）"
              },
              "ng_examples": {
                "type": "array",
                "items": { "type": "string" }
              },
              "ok_examples": {
                "type": "array",
                "items": { "type": "string" }
              },
              "problem_template": {
                "type": "string",
                "minLength": 1
              },
              "suggestion_template": {
                "type": "string",
                "minLength": 1
              },
              "enabled": {
                "type": "boolean",
                "description": "デフォルトで有効にするかどうか"
              }
            }
          }
        }
      }
    }
  }
}