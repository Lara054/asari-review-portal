{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://asari.review/specs/review_output.schema.v2.json",
  "title": "Asari Review Output v2 (Category-first)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "REVIEW_SUMMARY",
    "REVIEW_ISSUES",
    "REVIEW_SUGGESTED_RULES"
  ],
  "properties": {
    "REVIEW_SUMMARY": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "reviewedAt",
        "summary",
        "scores"
      ],
      "properties": {
        "reviewedAt": {
          "type": "string",
          "minLength": 10
        },
        "summary": {
          "type": "string",
          "minLength": 1
        },
        "scores": {
          "type": "object",
          "description": "カテゴリ別スコア（0〜10）。カテゴリを増やす場合は必ずここへ追加。",
          "additionalProperties": false,
          "properties": {
            "structure": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "wording": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "risk": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "delivery": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "logic": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "audience_fit": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "engagement": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "overall": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "全カテゴリから算出される総合（0〜10）"
            }
          },
          "required": [
            "overall"
          ]
        }
      }
    },
    "REVIEW_ISSUES": {
      "type": "array",
      "description": "検出された指摘一覧",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "category",
          "severity",
          "rule_id",
          "rule_title",
          "line",
          "snippet",
          "problem",
          "suggestion"
        ],
        "properties": {
          "category": {
            "type": "string",
            "enum": [
              "structure",
              "wording",
              "risk",
              "delivery",
              "logic",
              "audience_fit",
              "engagement"
            ],
            "description": "カテゴリ追加時は enum を更新"
          },
          "severity": {
            "type": "string",
            "enum": [
              "high",
              "medium",
              "low",
              "info"
            ]
          },
          "rule_id": {
            "type": "string",
            "minLength": 1
          },
          "rule_title": {
            "type": "string",
            "minLength": 1
          },
          "line": {
            "type": "integer",
            "minimum": 1
          },
          "snippet": {
            "type": "string",
            "minLength": 1
          },
          "problem": {
            "type": "string",
            "minLength": 1
          },
          "suggestion": {
            "type": "string",
            "minLength": 1
          }
        },
        "ruleset_id": {
        "type": "string",
        "minLength": 1,
        "description": "この指摘が属するルールセットID（例: base / risk / asari_persona）"
        },
        "ruleset_name": {
          "type": "string",
          "minLength": 1,
          "description": "ルールセットの表示名（例: Base Rules）"
        }
      }
    },
    "REVIEW_SUGGESTED_RULES": {
      "type": "array",
      "description": "AIが提案する新規ルール候補",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "title",
          "description",
          "reason",
          "suggested_category",
          "severity"
        ],
        "properties": {
          "title": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "minLength": 1
          },
          "reason": {
            "type": "string",
            "minLength": 1
          },
          "suggested_category": {
            "type": "string",
            "enum": [
              "structure",
              "wording",
              "risk",
              "delivery",
              "logic",
              "audience_fit",
              "engagement"
            ],
            "description": "カテゴリ追加時は enum を更新"
          },
          "severity": {
            "type": "string",
            "enum": [
              "high",
              "medium",
              "low",
              "info"
            ]
          },
          "checklist": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "このルール候補を実際に適用する際に確認すべき観点の配列（任意）。5-1 の checklist と同様に短い日本語文を並べる。"
          },
          "problem_template": {
            "type": "string",
            "description": "このルール候補を本番ルールとして適用する場合に使用する指摘メッセージのテンプレート（任意。固定値として本番運用時に記入）。"
          },
          "suggestion_template": {
            "type": "string",
            "description": "このルール候補を本番ルールとして適用する場合に使用する改善提案メッセージのテンプレート（任意。固定値として本番運用時に記入）。"
          },
          "examples": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "ng",
              "ok"
            ],
            "properties": {
              "ng": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "ok": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "enable": {
            "type": "boolean",
            "description": "このルール候補を本番ルールとして有効化するかどうかのフラグ（任意。false に設定すると本番ルールには追加されない）。"
          
          }
        }
      }
    }
  }
}